
## UDNS简介
UDNS服务是UCloud提供的高可用、可扩展的域名解析服务系统。利用UDNS提供的内网解析服务，可以用于实现服务发现、负载均衡、服务高可用等场景。

## DNS服务简介
DNS（Domain Name System），是目前互联网依赖的一项服务，作为将域名和IP地址互相映射的系统，使人和业务都能更方便的访问互联网资源。DNS默认使用TCP和UDP的53端口。实际上，DNS查询一般使用UDP协议，使用TCP的情况非常罕见。UDNS系统提供的就是UDP的服务。

用户可以在UDNS中配置多种类型的记录，详细描述如下：

- **A记录**

如果该记录是一条A记录，那么记录对应的值为一个或者多个IPv4地址。用户通过设置A记录，即可实现域名到IPv4地址的转换。

- **AAAA记录**

如果该记录是一条A记录，那么记录对应的值为一个或者多个IPv6地址。用户通过设置AAAA记录，即可实现域名到IPv6地址的转换。

- **CNAME记录**

如果该记录是一条CNAME记录，那么记录对应的值是一个域名。CNAME记录用于将改记录的所有查询转向另外一个域名。

- **SRV记录**

如果该记录是一条SRV记录，那么记录对应的值格式如下：

[priority] [weight] [port] [host-name]

其中：
1. priority为优先级， 取值范围为 0-65535。

2. weight为权重，取值范围为 1-65535。

3. port为服务端口号，取值范围为 0-65535。

4. host-name 为一个域名。

SRV记录用于定义提供特定服务的服务器的名称和端口。

- **MX 记录**

如果该记录是一条MX记录，那么记录对应的值格式如下：

[priority] [host-name]

其中：
1. priority为优先级，取值范围为0-65535，值越小，优先级越高。

2. host-name为一个域名，对应邮件服务器的地址。

MX记录用于定位邮件服务的地址。如果要发送邮件到 user@aaa.com, 那么首先就需要通过DNS查询aaa.com 对应的MX地址。 如果MX记录的值仅有一条，那么优先级不生效。如果MX记录的值有多条，那么会优先将邮件投递到优先级高的服务器上，如果投递失败，将顺序查找优先级次高的服务器。

- **PTR记录**
PTR记录用于进行DNS的反向查询。主机记录格式必须为10.0.0.0/8、172.16.0.0/12、192.168.0.0/16三个内网网段中的IP地址的逆向排列。例如IP地址为192.168.2.3则逆向排列为3.2.168.192。


## 架构介绍
UCloud 内网DNS集群，采用BGP+ECMP实现高可用及高扩展性。架构如下图：
![images](/images/DNS集群架构.png)

如上图所示，UCloud提供的UDNS服务是地域级别的产品。DNS集群可以认为是一个无状态的服务，每台服务器都可以独立对外提供服务。DNS服务器通过BGP对上游交换机宣告相同的VIP。DNS服务发生异常的时候，会宣告BGP的中断，从而将流量切换到其他服务器上，实现高可用。
